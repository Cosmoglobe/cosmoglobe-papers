%                                                                 aa.dem
% AA vers. 9.1, LaTeX class for Astronomy & Astrophysics
% demonstration file
%                                                       (c) EDP Sciences
%-----------------------------------------------------------------------
%
% \documentclass[referee]{aa} % for a referee version
%\documentclass[onecolumn]{aa} % for a paper on 1 column  
%\documentclass[longauth]{aa} % for the long lists of affiliations 
%\documentclass[letter]{aa} % for the letters 
%\documentclass[bibyear]{aa} % if the references are not structured 
%                              according to the author-year natbib style

%

\documentclass[twocolumn]{aa}  

%
\usepackage{graphicx}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{natbib}
\usepackage{tabularx}
\usepackage{collcell}
\usepackage{array}
\usepackage{booktabs}
\usepackage{subfigure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{txfonts}
\usepackage{xcolor}
\usepackage{blindtext}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \usepackage[options]{hyperref}
% To add links in your PDF file, use the package "hyperref"
% with options according to your LaTeX or PDFLaTeX drivers.
\usepackage{float}
%\usepackage{stfloats}
\usepackage{dblfloatfix}
\usepackage{afterpage}
\usepackage{ifthen}
\usepackage[morefloats=12]{morefloats}
\usepackage{tabularx}
\usepackage{placeins}
\usepackage{multicol}
%\usepackage[breaklinks,colorlinks,citecolor=blue]{hyperref}
\bibpunct{(}{)}{;}{a}{}{,}
\usepackage[switch]{lineno}
\definecolor{linkcolor}{rgb}{0.6,0,0}
\definecolor{citecolor}{rgb}{0,0,0.75}
\definecolor{urlcolor}{rgb}{0.12,0.46,0.7}
\usepackage[breaklinks, colorlinks, urlcolor=urlcolor,
linkcolor=linkcolor,citecolor=citecolor,pdfencoding=auto]{hyperref}
\hypersetup{linktocpage}
\usepackage{bold-extra}
\usepackage{ifthen}
\input{Planck}

% Custom definitions
\def\Cosmoglobe{\textsc{Cosmoglobe}}
\def\commander{\texttt{Commander}}
\def\commanderthree{\texttt{Commander3}}
\def\Commander{\texttt{Commander}}
\def\Planck{\textit{Planck}}
\def\WMAP{\textit{WMAP}}
\def\Spitzer{\textit{Spitzer}}
\def\Gaia{\textit{Gaia}}

\newcommand{\cii}{\ensuremath{\mathsc {C\ ii}}}

\newcommand{\nWmsr}{\mathrm{nW}\,\mathrm{m}^{-2}\,\mathrm{sr}^{-1}}
\newcommand{\um}{$\,\mu\mathrm{m}$}
\newcommand{\phm}{\phantom{-}}
\newcommand{\dv}[0]{\vec{d}}
\renewcommand{\t}[0]{\vec{t}}
\newcommand{\A}[0]{\tens{A}}
\newcommand{\B}[0]{\tens{B}}
\renewcommand{\G}[0]{\tens{G}}
\newcommand{\Y}[0]{\tens{Y}}
\newcommand{\n}[0]{\vec{n}}
\newcommand{\red}[0]{\color{red}}
\newcommand{\green}[0]{\color{green}}
\newcommand{\s}[0]{\vec{s}}
\renewcommand{\a}[0]{\vec{a}}
\newcommand{\m}[0]{\vec{m}}
\newcommand{\bv}[0]{\vec{b}}
\newcommand{\f}[0]{\vec{f}}
\newcommand{\F}[0]{\tens{F}}
\newcommand{\T}[0]{\tens{T}}
\newcommand{\Cp}[0]{\tens{C}}
\renewcommand{\L}[0]{\tens{L}}
\newcommand{\g}[0]{\vec{g}}
\newcommand{\N}[0]{\tens{N}}
\newcommand{\M}[0]{\tens{M}}
\newcommand{\iN}[0]{\tens{N}^{-1}}
\newcommand{\iM}[0]{\tens{M}^{-1}}
\newcommand{\w}[0]{\vec{w}}
\renewcommand{\S}[0]{\tens{S}}
\renewcommand{\r}[0]{\vec{r}}
\renewcommand{\u}[0]{\vec{u}}
\newcommand{\q}[0]{\vec{q}}
\renewcommand{\v}[0]{\vec{v}}
\renewcommand{\P}[0]{\tens{P}}
\newcommand{\dt}[0]{d_t}
\newcommand{\di}[0]{d_i}
\newcommand{\nt}[0]{n_t}
\newcommand{\st}[0]{s_t}
\newcommand{\mt}[0]{m_t}
\newcommand{\ft}[0]{f_t}
\newcommand{\Te}[0]{T_{\rm e}}
\newcommand{\EM}[0]{\rm EM}
\newcommand{\mathsc}[1]{{\normalfont\textsc{#1}}}
\newcommand{\hi}{\ensuremath{\mathsc {H\ i}}}
\newcommand{\bpbold}{\bfseries{\scshape{BeyondPlanck}}}
\newcommand{\BP}{\textsc{BeyondPlanck}}
\newcommand{\bp}{\textsc{BeyondPlanck}}
\newcommand{\cosmoglobe}{\textsc{Cosmoglobe}}
%\newcommand{\Cosmoglobe}{\textsc{Cosmoglobe}}
\newcommand{\lfi}[0]{LFI}
\newcommand{\hfi}[0]{HFI}
\newcommand{\npipe}[0]{\texttt{NPIPE}}
\newcommand{\K}[0]{\textit K}
\newcommand{\Ka}[0]{\textit{Ka}}
\newcommand{\Q}[0]{\textit Q}
\newcommand{\V}[0]{\textit V}
\newcommand{\W}[0]{\textit W}
\newcommand{\e}{\mathrm e}
\newcommand{\cvar}{\ensuremath{c(\vartheta, \varphi, \psi)}}


\def\Tcmb{\ifmmode T_\mathrm{CMB}\else $T_{\mathrm{CMB}}$\fi}
\def\Tcold{\ifmmode T_\mathrm{c}\else $T_{\mathrm{c}}$\fi}
\def\Thot{\ifmmode T_\mathrm{h}\else $T_{\mathrm{h}}$\fi}
\def\Tnear{\ifmmode T_\mathrm{n}\else $T_{\mathrm{n}}$\fi}
\def\scmb{\ifmmode s_\mathrm{CMB}\else $s_{\mathrm{CMB}}$\fi}
\def\squad{\ifmmode s_\mathrm{quad}\else $s_{\mathrm{quad}}$\fi}
\def\ssynch{\ifmmode s_\mathrm{s}\else $s_\mathrm{s}$\fi}
\def\sdust{\ifmmode s_\mathrm{d}\else $s_{\mathrm{d}}$\fi}
\def\ssdust{\ifmmode s_\mathrm{sd}\else $s_{\mathrm{sd}}$\fi}
\def\same{\ifmmode s_\mathrm{AME}\else $s_{\mathrm{AME}}$\fi}
\def\ssrc{\ifmmode s_\mathrm{src}\else $s_{\mathrm{src}}$\fi}
\def\sco{\ifmmode s_\mathrm{CO}\else $s_{\mathrm{CO}}$\fi}
\def\sff{\ifmmode s_\mathrm{ff}\else $s_{\mathrm{ff}}$\fi}
\def\gff{\ifmmode g_\mathrm{ff}\else $g_{\mathrm{ff}}$\fi}
\def\fsynch{\ifmmode f_\mathrm{s}\else $f_{\mathrm{s}}$\fi}
\def\fsd{\ifmmode f_\mathrm{sd}\else $f_{\mathrm{sd}}$\fi}
\def\fame{\ifmmode f_\mathrm{AME}\else $f_{\mathrm{AME}}$\fi}
\def\alphasrc{\ifmmode \alpha_\mathrm{src}\else $\alpha_{\mathrm{src}}$\fi}
\def\bcold{\ifmmode \beta_\mathrm{c}\else $\beta_{\mathrm{c}}$\fi}
\def\bhot{\ifmmode \beta_\mathrm{h}\else $\beta_{\mathrm{h}}$\fi}
\def\bnear{\ifmmode \beta_\mathrm{n}\else $\beta_{\mathrm{n}}$\fi}
\def\bsynch{\ifmmode \beta_\mathrm{s}\else $\beta_{\mathrm{s}}$\fi} 
\def\bsun{\ifmmode \beta_\mathrm{sun}\else $\beta_{\mathrm{sun}}$\fi} 
\def\nuzeros{\ifmmode \nu_{0,\mathrm{s}}\else $\nu_{0,\mathrm{s}}$\fi} 
\def\nuzeroff{\ifmmode \nu_{0,\mathrm{ff}}\else $\nu_{0,\mathrm{ff}}$\fi} 
\def\nuzerocold{\ifmmode \nu_{0,\mathrm{c}}\else $\nu_{0,\mathrm{c}}$\fi}
\def\nuzerohot{\ifmmode \nu_{0,\mathrm{h}}\else $\nu_{0,\mathrm{h}}$\fi}
\def\nuzeronear{\ifmmode \nu_{0,\mathrm{n}}\else $\nu_{0,\mathrm{n}}$\fi} 
\def\nuzeroame{\ifmmode \nu_{0,\mathrm{AME}}\else $\nu_{0,\mathrm{AME}}$\fi} 
\def\nuzerosd{\ifmmode \nu_{0,\mathrm{}}\else $\nu_{0,\mathrm{sd}}$\fi} 
\def\nuzerosrc{\ifmmode \nu_{0,\mathrm{src}}\else $\nu_{0,\mathrm{src}}$\fi} 
\def\nup{\ifmmode \nu_{\mathrm{p}}\else $\nu_{\mathrm{p}}$\fi} 
\def\alphasd{\ifmmode \alpha_{\mathrm{sd}}\else $\alpha_{\mathrm{sd}}$\fi} 
\def\Te{\ifmmode T_{\mathrm{e}}\else $T_{\mathrm{e}}$\fi} 
\def\kB{\ifmmode k_\mathrm{B}\else $k_{\mathrm{B}}$\fi} 

% \renewcommand{\topfraction}{1.0}	% max fraction of floats at top
%     \renewcommand{\bottomfraction}{1.0}	% max fraction of floats at bottom
%     %   Parameters for TEXT pages (not float pages):
%     \setcounter{topnumber}{2}
%     \setcounter{bottomnumber}{2}
%     \setcounter{totalnumber}{4}     % 2 may work better
%     \setcounter{dbltopnumber}{2}    % for 2-column pages
%     \renewcommand{\dbltopfraction}{0.9}	% fit big float above 2-col. text
%     \renewcommand{\textfraction}{0.04}	% allow minimal text w. figs
%     %   Parameters for FLOAT pages (not text pages):
%     \renewcommand{\floatpagefraction}{0.9}	% require fuller float pages
% 	% N.B.: floatpagefraction MUST be less than topfraction !!
%     \renewcommand{\dblfloatpagefraction}{0.9}	% require fuller float pages



\begin{document} 

   \title{\bfseries{\Cosmoglobe\ DR2. III. Improved modelling of zodiacal light emission in \textit{COBE}-DIRBE through Bayesian global analysis}}

   \input{authors.tex}

   %\institute{Institute of Theoretical Astrophysics, University of Oslo, Blindern, Oslo, Norway}
  
   % Shortened title, author list for top of page 
   \titlerunning{\Cosmoglobe: Interplanetary dust}
   \authorrunning{M.~San et al.}

   \date{\today}
   

% write an abstract 

   \abstract{We present an improved model of zodiacal light (ZL) emission for \textit{COBE}-DIRBE derived through global Bayesian analysis within \cosmoglobe\ Data Release~2 (DR2). The parametric form of the ZL model is identical to that introduced by Kelsall et al. (1998; K98), but the specific best-fit parameter values are rederived using the combination of DIRBE Calibrated Individual Observations (CIOs), \Planck\ HFI sky maps, and WISE and GAIA compact object catalogs. Furthermore, the ZL parameters are fitted jointly with astrophysical parameters, such as thermal dust and starlight emission, and the new model takes into account excess radiation that appears stationary in solar-centric coordinates as reported in a companion paper. The relative differences in predicted signals at 25$\,\mu\mathrm{m}$ between K98 and our new model are $\lesssim\,2\,\%$ in the Ecliptic plane, and $\lesssim\,5\,\%$ in the Ecliptic poles and along the asteroidal bands. The zero-level of the cleaned DR2 maps are lower than those of the legacy DIRBE Zodiacal light Subtracted Mission Average (ZSMA) maps by $\sim$\,10\,kJy/sr at 1.25--3.5\,$\mu\mathrm{m}$, which is comparable to the entire predicted contribution from high-redshift galaxies to the Cosmic Infrared Background (CIB) at the same wavelengths. The total rms's of each DR2 maps at wavelengths up to and including $60\,\mu\mathrm{m}$ are $\sim$\,30\,\% lower at high Galactic latitudes than the corresponding DIRBE ZSMA maps. The cleaned DR2 maps at 4.9 and 60\,$\mu\mathrm{m}$ are now for the first time visually dominated by Galactic signal at high latitudes rather than by ZL residuals. Even the 100$\,\mu\mathrm{m}$ channel, which has served as a cornerstone for Galactic studies for three decades, appears significantly cleaner in the current processing. Still, obvious ZL residuals can be seen even in several of the DR2 maps, and further work is required to mitigate these. Joint analysis with existing and future high-resolution full-sky surveys such as AKARI, IRAS, \Planck\ HFI, and SPHEREx will be essential both to break key degeneracies in the current model and to determine whether the reported solar-centric excess radiation has a ZL or instrumental origin. On the algorithmic side, more efficient methods for probing massively multi-peaked likelihoods should be explored and implemented. Thus, while the results presented in this paper do re-define the state-of-the-art for DIRBE modelling, it also only represents the first among many steps toward a future optimal Bayesian ZL model.
}

   \keywords{Zodiacal dust, Interplanetary medium, Cosmology: cosmic background radiation}

   \maketitle

\setcounter{tocdepth}{2}
\tableofcontents
   

\section{Introduction}
Zodiacal light (ZL, sometimes zodiacal emission or interplanetary dust
emission) is the primary source of diffuse radiation observed in the
infrared sky between 1-100 $\mu$m (see, e.g., \citealp{Leinert1998}
and references therein). This radiation comes from scattering and
re-emission of sunlight from interplanetary dust (IPD) grains, and was
first mapped in detail by the IRAS satellite
\citep{neugebauer:1984}.

The inner Solar system is embedded in a Sun centered cloud of IPD,
with a symmetry axis tilted slightly with respect to the Ecliptic,
known as the zodiacal cloud. The ZL is seasonal, and its appearance in
the sky changes as the Earth moves through the IPD distribution. The
most common way to model the observer position-dependent ZL is to
evaluate a line-of-sight integral for each observation directly in the
time-ordered domain. The time-varying and three-dimensional nature of
the ZL makes it one of the most challenging foregrounds to model in
astrophysical and cosmological studies of the infrared sky. The lack
of a high-accuracy ZL model has left a large part of the
electromagnetic spectrum inaccessible to cosmological analysis
attempting to measure the Cosmic Infrared Background (CIB;
\citealp{partridge1967,hauser1998,hauser:2001}).

One of the most widely used ZL models in the field of cosmology is the
\textit{COBE}/DIRBE model by \citet{Kelsall1998}, often simply
referred to as the K98 model. This is a parametric three-dimensional
model that describes the three-dimensional IPD distribution and the
radiative properties of dust using time-dependent measurements from
the \textit{COBE}/DIRBE instrument \citep{hauser1998}. Since then, our
understanding of the infrared sky has improved with new observational
data from experiments like WISE \citep{wright:2010}, Planck HFI
\citep{planck2016-l03}, and GAIA \citep{gaia:2016}. However, these
experiments have largely been analyzed individually, and little or no
coordinated effort has been made toward combining the data from these
experiments into one overall state-of-the-art model of the infrared
sky. The main goal of the current work, summarized in a series of
papers collectively denoted \cosmoglobe\ Data Release 2, is to make
the first step toward such a concordance model by leveraging recent
computational advances in Bayesian cosmological data analysis by the
\BP\ \citep[][and references therein]{BP2023,Galloway2023} and
\cosmoglobe\ \citep{Watts2023} collaborations. The computer code
implementation is called \commanderthree\ \citep{Galloway2023}, which
is a Bayesian Gibbs sampler that was originally designed for
end-to-end analysis of cosmic microwave background (CMB) experiments,
in particular \Planck\ LFI \citep{planck2016-l02} and \WMAP
\citep{bennett2012}. However, as demonstrated in the current work, the
same algorithms are after relatively minor modifications also directly
applicable to infrared measurements.

One of the most important generalizations required for application of
\commanderthree\ to the infrared sky is the implementation of an
accurate time-variable ZL model. In this paper we therefore implement
support for the K98 model in \commanderthree, and we apply this to the
time-domain DIRBE data. This new code implementation is based on ZodiPy 
\citep{San2024}, which is an Astropy-affiliated Python package for ZL 
simulations. As an early application of this framework, \cite{San2022} 
demonstrated the removal of ZL from the DIRBE TOD with ZodiPy using the 
K98 model.

The rest of the paper is organized as follows. In
Sect.~\ref{sect:zodi-model}, we introduce the K98 ZL model and discuss
implementation and optimization aspects. Next, in 
Sect.~\ref{sect:param-estimation}, we describe the algorithms and methods
used to fit the ZL parameters within the Cosmoglobe framework.
In Sect.~\ref{sect:data}, we describe the data used in the current
analysis, before summarizing the algorithms in
Sect.~\ref{sect:param-estimation}. We present our updated ZL model and
compare this with K98 in Sect.~\ref{sect:improved-model}. Finally, we
conclude in Sect.~\ref{sec:conclusions}.


\section{Zodiacal light modelling}\label{sect:zodi-model}
ZL is commonly modelled sample-by-sample in time-domain by performing
line-of-sight integration at each observation through a parametric
three-dimensional model of the IPD distribution. We adopt the same
general parametrization as introduced by K98 for the current
\commanderthree\ implementation, and in this section we briefly review
the main aspects of this model, aiming to build intuition about the
underlying parametric model. We also consider a few numerical
approximations that reduce the overall computational cost. For full
details of this model, we refer the interested reader to
\citet{Kelsall1998}.

\subsection{Parameterization of interplanetary dust}
IPD in the zodiacal cloud is overall smooth and stable 
\citep{Leinert1989}, and most of the dust may be accounted for by a 
diffuse cloud-like component \citep{Kelsall1998}. The origin of IPD 
is debris mainly from comets and asteroids, with potential additions 
from dusty planets like Mars \citep{Jorgensen2021}, additions from 
the Kupier belt \citep{Mann2009}, and interstellar dust passing 
through the Solar system \citep{Robinson2013, Mann2009}. The relative contribution to the overall 
IPD density is not well known, but many models predict the main 
source to be low-eccentricity Jupiter family comets that rapidy 
disintegrate due to frequent trips through the inner Solar system 
\citep{Robinson2013, Mann2009}.
However, fine structures within the zodiacal cloud exist as a result 
of collisions and fragmentation in asteroids and gravitational 
resonance in the orbit of planets 
\citep{Low1984, Dermott1984, Dermott1994, Reach1997}.

We model the IPD distribution as a combination of several zodiacal
components, each described by a number density $n_c(x,y,z)$, where $c$
indicates components and $x$, $y$ and $z$ indicate heliocentric
Ecliptic coordinates. Each zodiacal component is allowed to have a
heliocentric offset $(x_{0,c}, y_{0,c}, z_{0,c})$, such that the
component-centric coordinates become
\begin{equation}    
    \begin{aligned}
        x_c&= x - x_{0,c}\\
        y_c&= y - y_{0,c}\\
        z_c&= z - z_{0,c}.
    \end{aligned}
\end{equation}
Additionally, each zodiacal component is allowed to have a plane of
symmetry that is different from the Ecliptic, which is defined by an
inclination $i_c$ and an ascending node $\Omega_c$. Components that
happen to be azimuthally symmetric are then fully described by a
radial distance $r_c$ from the origin and the height above the
symmetry plane $Z_c$,
\begin{align}
    r_c &= \sqrt{x_c^2 + y_c^2 + z_c^2},\\
    Z_c &= x_c\sin{\Omega_c}\sin{i_c} - y_c \cos{\Omega_c}\sin{i_c} + z_c \cos{i_c},\\
    \zeta_c &= \frac{|Z_\mathrm{c}|}{r_\mathrm{c}},
\end{align}
where $\zeta_c$ is the radial height above the symmetry plane.

\subsection{Zodiacal components}

With these definitions in hand, we now define parametric models for
each IPD component type.

\subsubsection{Smooth cloud}
By far the most important component is typically referred to as the
``zodiacal cloud''. This component represents the smooth IPD
distribution that embeds the inner Solar system. Its number density is
modeled as
\begin{equation}
    n_\mathrm{C}(x,y,z)=n_{0,
      \mathrm{C}}r_\mathrm{C}^{-\alpha}f(\zeta_\mathrm{C}),
    \label{eq:cloud}
\end{equation}
where $n_{0, \mathrm{C}}$ is the number density at 1\,AU, $\alpha$ is a 
power-law index, $f(\zeta_\mathrm{C})$ is the fan-like vertical 
distribution given as 
\begin{equation}
    f(\zeta_\mathrm{C}) = \exp {\left[-\beta g^\gamma \right]},
\end{equation}
with
\begin{equation}
    g = \begin{cases}
        \zeta^2/2\mu & \mathrm{for}\; \zeta < \mu,\\
        \zeta - \mu/2 & \mathrm{for}\; \zeta \geq \mu,
    \end{cases}
\end{equation}
where $\beta$, $\gamma$ and $\mu$ are shape parameters.

\subsubsection{Dust bands}
Next, three dust bands are included in the model to represent the
observed shoulder-like structure in the IRAS scans across the ecliptic
plane.  These bands appear at Ecliptic latitudes of $\pm \sim
1.4^\circ$, $10^\circ$, and $15^\circ$, and are associated with the
a blend of the Themis and Koronis, the Eos, and the IO/Maria asteroid families, 
respectively \citep{Reach1997}. Each dust band, indicated by $B_ii$, is 
modeled as
\begin{align}
    n_{\mathrm{B}_i}(x,y,z) &= \frac{3 n_{0, \mathrm{B}_i}}{r_{\mathrm{B}_i}} \exp \left[-\left(\frac{\zeta_{\mathrm{B}_i}}{\delta_{\zeta_{\mathrm{B}_i}}}\right)^{6}\right]\left[1 + \left(\frac{\zeta_{\mathrm{B}_i}}{\delta_{\zeta_{\mathrm{B}_i}}}\right)^{p}v^{-1}\right] \\
    &\times\left\{1-\exp \left[-\left(\frac{r_{\mathrm{B}_i}}{\delta_{r_{\mathrm{B}_i}}}\right)^{20}\right]\right\},
\label{eq:band}
\end{align}
where $n_{0, \mathrm{B}_i}$ is the number density of band $\mathrm{B}_i$ 
at 3\,AU, $\delta_{r_{\mathrm{B}_i}}$ is the inner radial cut-off, and 
$p$, $v$ and $\delta_{\zeta_{\mathrm{B}_i}}$ are shape parameters.

\subsubsection{Circum-solar ring and Earth-trailing feature}
\label{sec:ring}
Finally, a circum-solar ring (denoted ``SR'') component is included in the
model to represent dust that has accumulated in Earth's orbit due to
gravitational effects \citep{Dermott1994}. This component also
includes an enhancement to the IPD distribution at Earth's wake, known
as the ``Earth-trailing feature'' (denoted ``TF''). The ring component is modeled as
\begin{align}
    n_\mathrm{R}(x, y, z, \theta)&=n_{0, \mathrm{SR}} \exp \left[-\frac{\left(r_\mathrm{R}-r_{0, \mathrm{SR}}\right)^2}{\sigma_{R,\mathrm{SR}} ^2}-\frac{\left| Z_\mathrm{R} \right|}{\sigma_{Z, \mathrm{SR}}}\right],\\
   &+ n_{0, \mathrm{TF}} \exp \left[-\frac{\left(r_\mathrm{R}-r_{0,
          \mathrm{TF}}\right)^{2}}{\sigma_{R,
          \mathrm{TF}}^{2}}-\frac{\left|Z_\mathrm{F}\right|}{\sigma_{Z,
          \mathrm{TF}}}-\frac{\left(\theta-\theta_{0,
          \mathrm{TF}}\right)^{2}}{\sigma_{\theta,\mathrm{TF}}^{2}}\right],
    \label{eq:ring}
\end{align}
where $\theta$ is the heliocentric longitude of the Earth, and the 
radial locations $r_{0, \mathrm{SR}}$, $r_{0, \mathrm{TF}}$ specify
the distances to the peak densities $n_{0, \mathrm{SR}}$, 
$n_{0, \mathrm{TF}}$. The $\sigma$ parameters are length scales for the 
$r$, $Z$ and $\theta$ parameters, respectively. We note that the 
Earth-trailing feature depends on the position of the Earth and does not 
have a plane symmetry like the other zodiacal components. 


\subsection{Radiative and scattering properties}
Equations~\eqref{eq:cloud}--\eqref{eq:ring} define the number density
of each component. However, the signal actually measured with an
infrared detector is defined by an intensity, $I_{\nu}$, typically
measured in units of MJy$\,\mathrm{sr}^{-1}$ or
nW$\,\mathrm{m}^{-2}\,\mathrm{sr}^{-1}$. The connection between the
number density and this thermal emission is modeled in terms
of a blackbody modified by an emissivity factor $E_{c, \lambda}$,
\begin{equation}
    I^\mathrm{Thermal}_{c,\lambda} = E_{c,\lambda} B_\lambda(T),
\end{equation}
where $B_\lambda$ is the Planck function at a wavelength $\lambda$
\citep{Kelsall1998}. A key parameter in this equation is the IPD
temperature $T$, which is assumed to fall off with radial distance $r$
from the Sun as
\begin{equation}
    T(r) = T_0 r^{-\delta},
\end{equation}
where $T_0$ is the temperature of IPD at 1\,AU and $\delta$ is a power
law index. In addition to emitting thermally, IPD grains also scatter
sunlight in near-infrared wavelengths. The contribution to the total
signal from scattering reads
\begin{equation}\label{eq: scat_term}
    I^\mathrm{Scattering}_{c, \lambda} = A_{c, \lambda} F_\lambda^\odot(r) \Phi_\lambda(\Theta),
\end{equation}
where $A_{c, \lambda}$ is the albedo (or reflectivity) of the IPD,
$F_\lambda^\odot(r)$ the solar flux at a radial distance from the Sun,
and $\Phi_\lambda(\Theta)$ is the so-called phase function for scattering angles
$\Theta$, which describes the angular distribution of the scattered
light \citep{Kelsall1998}.

\begin{figure}
  \includegraphics[width=0.95\columnwidth]{figs/band3_dens.pdf}\\
  \includegraphics[width=0.95\columnwidth]{figs/band3_inst.pdf}\\
  \includegraphics[width=0.95\columnwidth]{figs/band3_ma.pdf}\\
  \includegraphics[width=0.95\columnwidth]{figs/band3_omega.pdf}
  \caption{Geometry of the third asteroidal dust band. (\textit{First row}:)
    Slice through the $x$--$z$ plane of the number density, $n_{0}$,
    in heliocentric coordinates. The positions of the Sun and Earth
    are marked by orange and green dots, respectively. (\textit{Second
    panel}:) Observed instantaneous intensity plotted in Ecliptic
    coordinates, obtained by integrating the above figure along each
    line-of-sight. (\textit{Third row}:) Same as above, but plotted in
  Galactic coordinates and averaged over a full year of
  observations. (\textit{Fourth row}:) Difference between observed
  intensities as defined in the third row after changing the value of
  the ascending node, $\Omega$, by 10\,\%. Similar plots for all
  components and parameters are provided in Appendices~\ref{sec:zodi-comps} and \ref{sec:param-atlas}.}
  \label{fig:band3}
\end{figure}

The total intensity from a single IPD grain is then
\begin{align}\label{eq:I_tot}
    I^\mathrm{Total}_{c, \lambda} &= I^\mathrm{Scattering}_{c,\lambda} + I^\mathrm{Thermal}_{c,\lambda}\\
    &= A_{c, \lambda} F_\lambda^\odot \Phi_\lambda + E_{c,\lambda} B_\lambda.
\end{align}
The total ZL signal may then be evaluated by summing up the intensity
from all dust grains, which in practice means evaluating a line-of-sight 
integral for each observation,
\begin{equation}\label{eq:los}
    I_{p,t} = \sum_c \int n_c \left[  A_{c, \lambda} F_\lambda^\odot \Phi_\lambda + \left( 1 - A_{c, \lambda} \right) E_{c,\lambda} B_\lambda \right]\,ds.
\end{equation}
Here, $p$ represents an observed pixel or direction in the sky, $t$ is
the time of observation; $n_c$ is the number density of component $c$
in the line-of-sight; and $ds$ is a small distance along the
line-of-sight $s$ from the observer and towards $p$. Note that
Eqs.~\eqref{eq:los} and~\eqref{eq:I_tot} differ by a factor (1 -
$A_{c, \lambda}$). This factor represents the extinction that occurs
when thermal emission is scattered away from the line-of-sight.

\subsection{Model intuition}

As described above, the K98 model has only $\mathcal{O}(10^2)$ free
parameters, which we collectively denote
$\zeta_{\mathrm{z}}$. Clearly, this is in reality far too few to fully
capture the true complex nature of ZL across many decades in
wavelength. However, even with such a limited number of parameters,
the model is still severely under-constrained when fitted to the DIRBE
data, and the corresponding posterior distribution exhibits many
strong degeneracies. Consequently, most currently available parameter
estimation algorithms are prone to getting trapped in local posterior
maxima, and this then will result in significant residuals in the
final ZL cleaned maps.

In order to interpret such residuals, and potentially define better
starting points for the non-linear optimization algorithm, it is
useful to build up human visual intuition regarding the impact of each
free parameter. Figure~\ref{fig:band3} shows one specific (and
arbitrary) example of this. First, the top panel shows a
$x$--$z$-plane slice through the three-dimensional IPD number density
distribution for the third dust band, $B_3$. In this figure, the
orange dot markes the Sun's position, while the green dot markes the
observer's (or Earth's) position. Here it is worth noting that this
component is azimuthally symmetric about the Sun, and the full 3D
structure may therefore be visualized by rotating this figure about
the vertical $z$-axis. In this space, it is quite straightforward to
visualize the effect of each free parameter defined by
Eq.~\eqref{eq:band}. For instance, the position of the inner radial
cut-off can be changed by modifying $\delta_{r}$, while the angle
between the $x$-axis and the peak densities may be changed through
$\delta_{\zeta}$. If we modify the $x_0$ offset, the entire density
field will shift left or right.

The second panel in Fig.~\ref{fig:band3} shows the corresponding
signal in Ecliptic coordinates at one single point in time after
integrating the density field along each line-of-sight. The Sun's
position is again marked by an orange dot, but in this case there is
obviously no observer position, since this figure shows the sky as
seen outwards from the observer. In this projected 2D space, the
observed structures appear significantly more difficult to visualize
than in 3D space. For instance, while the density of the dust bands
appear symmetric in 3D space, their apparent separation and width as
seen from Earth vary significantly with Ecliptic longitude; they
appear broader in directions that are closer to the Earth, and
narrower where they are further away.

The third panel shows the same feature, but now averaged over a whole
year of observations and plotted in Galactic coordinates. This
represents the signal seen in full-mission maps derived from
DIRBE. Since the underlying IPD structure is azimuthally symmetric
about the Sun, the Earth's movement throughout the year also
symmetrizes the total co-added signal, and the dust bands once again
appear symmetric about the Ecliptic plane. However, some small-scale
structures also appear because of small variations in the effective
scanning path of the instrument from day to day; if an entire day's
worth of observations were missing, for instance due to a period of
excessive cosmic ray radiation, strong stripes would appear in this
map.

With the infrastructure for computing such full-mission maps ready at
hand, we can study the impact of each free parameter in greater
detail. As a specific example of this, the bottom panel in
Fig.~\ref{fig:band3} shows the difference between the total signal
obtained when changing the ascending node for Band~3 by 10\,\%
relative to the base model. Intuitively, this corresponds to rotating
the signal in the top figure slightly about the origin. Some parts of
the bands will then appear closer to the Earth, while others will
appear further away. Those regions then in turn appear either red or
blue in the bottom figure. The resulting pattern is a unique
signature for $\Omega$, and if similar structures are observed in the
final ZL cleaned maps, then one should consider modifying this
particular parameter in a future analysis.

Similar figures are provided for all components and all parameters in
Appendices~\ref{sec:zodi-comps} and \ref{sec:param-atlas}, and these
are very useful for building up visual intuition regarding the K98
model. Quickly scanning through the individual panels in
Figs.~\ref{fig:atlas1} and \ref{fig:atlas2}, we can already now
identify strong degeneracies that are likely to turn out problematic
later. For instance, we see that $n_{0,\mathrm{C}}$,
$\alpha_\mathrm{C}$, $n_{0,\mathrm{SR}}$, $T_0$, and $\delta$ are all
dominated by a ring centered along the Ecliptic plane, and these are
likely to interplay significantly. Furthermore, many of these
parameters will obviously also couple significantly to a wide range of
non-ZL type parameters when integrated into a global analysis
framework, including the all-important CIB monopoles, such as
$n_{0,\mathrm{C}}$, $\sigma_{z,\mathrm{SR}}$, and
$\sigma_{\theta,\mathrm{TF}}$.

\begin{figure}
    \includegraphics[width=\columnwidth]{figs/cache_error_delta_t.pdf}\\
    \includegraphics[width=\columnwidth]{figs/cache_error_z.pdf}
    \caption{Errors induced by the ZL cache. \textit{(Top):} Difference between two 
    instantaneous view of the ZL 900\,km above Earth's north and south 
    poles. \textit{(Bottom):} Difference between two instantaneous views of the ZL at $N_\mathrm{studies}=512$, 
    separated by 2 hours. Pixels with an angular separation $\leq 60^\circ$ from the Sun 
    are masked in both maps.}
    \label{fig:cache-error}
\end{figure}



\subsection{Numerical optimizations}\label{sect:optimization}
Performing the line-of-sight integrals defined by Eq.~\eqref{eq:los}
is an expensive part in the \cosmoglobe\ DR2 analysis pipeline already
for the DIRBE data, which only comprise 18\,GB after compression. In
principle, this could be done by brute-force for this particular
experiment on modern computer clusters, but such a direct approach
will clearly not be an option for similar analyses of \Planck\ HFI,
AKARI and SPHEREx. Fortunately, several optimizations are available
for signals that are smooth in both space and time that result in
significant speed-ups at a very low accuracy penalty.

The first and perhaps most trivial optimization is to utilize a ZL
cache coupled to a discrete pixelization. As described in
Sect.~\ref{sect:data}, we employ a
HEALPix\footnote{\url{http://healpix.sourceforge.io}} pixelization
with $7\arcm\times7\arcm$ ($N_{\mathrm{side}}=512$; \citealp{healpix})
in the current analysis, and all satellite pointings are discretized
to this resolution; that is, we do not account for sub-pixel structure
in the signal model. The cache takes advantage of this by reusing a
previously computed ZL estimate for a given sky pixel when
re-observing a HEALPix pixel within a small timeframe $\Delta t$
\begin{equation}
 s_\mathrm{zodi}(p, t_i) = s_\mathrm{zodi}(p, t_j).
\end{equation}
This cache induces an error on the ZL estimate proportional to $\Delta
t$, which comes from the changes to the observer position with respect
to the zodiacal cloud within the $\Delta t$ timeframe. For reference,
the structure of the ZL on the Ecliptic or Galactic sky maps moves by
about $1^\circ$ a day as the Earth orbits the Sun. The top panel in
Fig.~\ref{fig:cache-error} shows the difference between the exact
instantanous calculation and one that is delayed by $\Delta t =
2\,$hrs for the DIRBE 25\,${\mu}$m channel. The error is less than
5\,kJy/sr, which about two orders of magnitude lower than the
total ZL uncertainties. On average, caching reduces the total number
of ZL model evaluations by a factor of $X$.

In addition to the positional change along Earth's orbit, it is
important to note that COBE also orbits the Earth at an altitude of
900\,km. The specific position of the observer is not taken into
account when using the cache. The bottom panel in
Fig.~\ref{fig:cache-error} shows the difference between two
instantaneous full-sky views at 25 $\mu$m, one simulated from the
North pole and the other from the South pole. The magnitude of this
error is $\lesssim\,1$kJy/sr, which is also far below DIRBE's
sensitivity.


The smooth nature of the ZL can be exploited in more ways. When
sampling parameters for the ZL model it is possible to include only a
small fraction of the full dataset in each likelihood evaluation,
simply because the signal-to-noise ratio of each sample is so high,
and because the of the smooth ZL gradient of the ZL
structure. Intuitively speaking, white instrumental noise is
irrelevant compared to overall systematic model uncertainties, and
some number of consecutive time-domain samples therefore provide
essentially the precisely same information. In our current analysis,
we adopt a thinning factor of eight, meaning that we effectively fit
the data to a timestream sampled at 1\,Hz rather than original the
8\,Hz DIRBE CIOs. In principle, we could have averaged over this time
segment, rather than simply omitting the relevant samples, in order to
suppress instrumental noise; and, in fact, the first implementation of
our computer code did exactly this. However, averaging over 1\,sec
time scales implies that the true underlying model is also smoothed
out the same time scales, and this increases the overall modeling
errors. Although the differences were generally small, we obtained
slightly better fits by thinning rather than averaging.

In addition, the smoothness of the ZL is exploited further during
parameter estimation by defining the cache at a pixel resolution of
$1^{\circ}$ ($N_\mathrm{side} = 64$), rather than the original
$N_\mathrm{side} = 512$. We find that this results in very similar
$\chi^2$ values, while further reducing the number of ZL evaluations
used in the sampling steps by a factor of 64. 



\section{Methods}\label{sect:param-estimation}

The main operational goal of this paper is to measure the free ZL
parameters, $\zeta_{\mathrm{z}}$, using time-ordered data from the
DIRBE instrument. However, these data contain many other physical
effects in the form of both instrumental and astrophysical confusion
\citep[e.g.,][]{hauser1998,arendt1998}. In order to estimate
$\zeta_{\mathrm{z}}$ robustly, it is essential to account for all
those other degrees of freedom at the same time. On the other hand,
many of those parameters have only a limited signal-to-noise ratio
with DIRBE data alone, and far stronger constraints will typically
result from combining the DIRBE measurements with external
data. Enabling such global multi-experiment analysis is a main goal of
the \cosmoglobe\ framework. In this section, we briefly review the key
ideas behind this approach, and we describe the generalizations that
are required for ZL parameter estimation. For full details, we refer
the interested reader to \citet{Watts2023,CG02_01}. However, we
emphasize that the approach presented here is only a first step, and
future work should aim at implementing faster and more robust
algorithms.


\subsection{Data model, posterior distribution, and Gibbs sampling}

The first step in many Bayesian parameter estimation methods is to
write down an explicit parametric data model. For \cosmoglobe\ DR2, we
adopt the following model,
\begin{align}
	\label{eq:model}
	\dv &=\G\P\B\sum_{c=1}^{n_{\mathrm{comp}}}\M_c\a_c+\s_{\mathrm{zodi}} +
          \s_{\mathrm{static}} + \n,\\
        &\equiv \s^{\mathrm{tot}} + \n,
\end{align}
where $\dv$ denote observed data; $\G$ denotes an overall calibration
factor; $\P$ and $\B$ represent the instrumental pointing and beam,
respectively; the sum over components $c$ represents the contribution
from astrophysical components (thermal dust, free-free, starlight
emission etc.), each described by an overall amplitude (which may be a
pixelized map) and a mixing matrix, $\M$, which depends on some set of
unknown SED parameters, $\beta$; and $\n$ denotes instrumental
noise. We denote the set of all free parameters in Eq.~\ref{eq:model}
by $\omega$, and for a full explicit definition of this parameter set,
we refer the interested reader to \citet{CG02_01}.

As far as this paper is concerned, the key term is
$\s_{\mathrm{zodi}}$, which is nothing but Eq.~\eqref{eq:los}
evaluated along the line-of-sight defined by the pointing $\P$. This
term depends on $\zeta_{\mathrm{z}}$, and our task in this paper is to
establish an approximation to the marginal posterior distribution,
$P(\zeta_{\mathrm{z}}|\dv)$. One straightforward way of computing this
marginal distribution is, perhaps somewhat surprisingly, to first
consider the much bigger task of estimating the full joint posterior
distribution, $P(\omega|\dv)$ --- which now includes billions of
correlated parameters rather than just a hundred! The reason for why
this a computationally more straightforwared problem is that the joint
distribution has a well-defined and simple analytic expression that it
is possible to sample from, while the marginal distribution does not;
for early CMB applications of this two-stage approach, see
\citet{jewell2004,wandelt2004,eriksen:2004}.


In order for this to work, we have to assume that the instrumental
noise, $\n=\dv-\s_{\mathrm{tot}}$, is Gaussian, and for most
instruments that is an excellent approximation. In that case, we can
write the likelihood, $\mathcal{L}(\omega) \equiv P(\dv|\omega)$, as
\begin{equation}
-2\ln\mathcal{L}(\omega) = (\dv-\s^{\mathrm{tot}}(\omega))^t
  \N_{\mathrm{w}}^{-1}(\dv-\s^{\mathrm{tot}}(\omega)) \equiv \chi^2(\omega),
\end{equation}
and the posterior distribution is then defined by Bayes' theorem,
\begin{equation}
P(\omega\mid\dv) = \frac{P(\dv\mid\omega) P(\omega)}{P(\dv)} \propto
\mathcal{L}(\omega) P(\omega).
\end{equation}
Here $P(\omega)$ is called the prior, which may be used to inject
prior knowledge about given parameters, while $P(\dv)$ is called the
evidence, which for our purposes is just a normalization constant.

In order to map out this full joint posterior, we use a statistical
method called Gibbs sampling \citep[e.g.,][]{geman:1984}, which allows
us to draw samples iteratively by scanning through all conditional
distributions, as opposed to drawing samples directly from the joint
distribution. Sampling from $N$ conditional distributions, each
defined by a simple analytical distribution, is typically much simpler
than drawing from a single joint $N$-dimensional distribution that
does not have a closed form analytical expression. In practice, for
the \cosmoglobe\ DR2 analysis this translates into the following
so-called Gibbs chain:
\begin{alignat}{11}
    \tens{G} &\,\leftarrow P(\tens{G}&\,\mid &\,\dv,&\, &\,\phantom{\tens{G}} &\,\xi_n, &
    \,\beta_{\mathrm{sky}}& \,\a_{\mathrm{sky}}, &\,\zeta_{\mathrm{z}},
    &\,\a_{\mathrm{static}})\label{eq:gibbs_G}\\
    \xi_{\mathrm{n}} &\,\leftarrow P(\xi_{\mathrm{n}}&\,\mid &\,\dv,&\, &\,\tens{G}, &\,\phantom{\xi_n} &
    \,\beta_{\mathrm{sky}}& \,\a_{\mathrm{sky}}, &\,\zeta_{\mathrm{z}},
    &\,\a_{\mathrm{static}})\\
    \beta_{\mathrm{sky}} &\,\leftarrow P(\beta_{\mathrm{sky}}&\,\mid &\,\dv,&\, &\,\tens{G}, &\,\xi_n, &
    \,\phantom{\beta_{\mathrm{sky}}}& \,\a_{\mathrm{sky}}, &\,\zeta_{\mathrm{z}}, &\,\a_{\mathrm{static}})\\
    \a_{\mathrm{sky}} &\,\leftarrow P(\a_{\mathrm{sky}}&\,\mid &\,\dv,&\, &\,\tens{G}, &\,\xi_n, &
    \,\beta_{\mathrm{sky}},& \,\phantom{\a_{\mathrm{sky}},}
    &\,\zeta_{\mathrm{z}}, &\,\a_{\mathrm{static}})\\
    \zeta_{\mathrm{z}} &\,\leftarrow P(\zeta_{\mathrm{z}}&\,\mid &\,\dv,&\, &\,\tens{G}, &\,\xi_n, &
    \,\beta_{\mathrm{sky}},& \,\a_{\mathrm{sky}},
    &\,\phantom{\zeta_{\mathrm{z}},} &\,\a_{\mathrm{static}})\label{eq:gibbs_zodi}\\
    \a_{\mathrm{static}} &\,\leftarrow P(\a_{\mathrm{static}}&\,\mid &\,\dv,&\, &\,\tens{G}, &\,\xi_n, &
    \,\beta_{\mathrm{sky}},& \,\a_{\mathrm{sky}}, &\,\zeta_{\mathrm{z}} &\,\phantom{\a_{\mathrm{static}}})\label{eq:gibbs_static},
\end{alignat}
where $\leftarrow$ indicates the process of drawing a sample from the
distribution on the right-hand side. Each sampling step in this chain
is described by \citet{CG02_01} and references therein --- except for
Eq.~\eqref{eq:gibbs_zodi}, which is the main topic of this paper.

Based on the data model in Eq.~\ref{eq:model}, we can define the
following residual
\begin{equation}
\r = \dv - (\G\P\B\sum_{c=1}^{n_{\mathrm{comp}}}\M_c\a_c +
          \s_{\mathrm{static}}),
\end{equation}
and this should ideally only contain ZL and noise. As such, the
assumed Gaussianity of the noise also defines the conditional
distribution in Eq.~\eqref{eq:gibbs_zodi}, and we may write
\begin{equation}
  -2\ln P(\zeta_{\mathrm{z}}|\dv, \ldots) = \sum_{\nu}
  \left(\frac{\r_{\nu} -
    \s_{\nu,\mathrm{zodi}}(\zeta_\mathrm{s})}{\sigma_{\nu}}\right)^2 \equiv
  \chi^2 (\zeta_{\mathrm{z}}),
  \label{eq:gibbs_chisq}
\end{equation}
where we have introduced multiple data frequency channels, denoted by
$\nu$, and also for simplicity neglected the prior,
$P(\zeta_{\mathrm{z}})$. In this framework, ZL parameter estimation is
thus nothing but a traditional Gaussian $\chi^2$ sampling or
optimization problem after all non-ZL contributions have been
subtracted from the $\dv$. Precisely how we implement this operation
in the current pipeline is described in Sect.~\ref{sec:nonlin}.

So far we have silently skipped past one important term in
Eq.~\eqref{eq:model}, namely $\s_{\mathrm{static}}$. This is described
in detail by \citet{CG02_01}, and as far as the algorithms in the
current paper are concerned, this is simply a fixed correction term
that is always applied to the raw time-ordered data. However, its
origin and impact are highly relevant for ZL fitting, and it is
therefore worth briefly reviewing the salient points from the original
analysis here.

\begin{figure*}
    \centering
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/week/week_I_nu.pdf}%
    \includegraphics[height=1cm]{figs/week/week_delta_I_nu.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/week/week_Z_nu.pdf}%
    \includegraphics[height=1cm]{figs/week/week_delta_Z_nu.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/week/week_tod_nu.pdf}%
    \includegraphics[height=1cm]{figs/week/week_delta_tod_nu.pdf}%
    }\\
    \caption{Illustration of the basic sky maps involved in the zodiacal 
    light fitting algorithms adopted by the DIRBE (\emph{right column}) 
    and \Cosmoglobe\ (\emph{left column}) pipelines for one week of 
    $25\,\mu\mathrm{m}$ observations and adopting the K98 model. The 
    DIRBE pipeline used exclusively differences between weekly and 
    full-season maps, both for the observed signal, 
    $\Delta I_{\nu} \equiv I_{\nu}-\left<I_{\nu}\right>$ (\emph{top right}), 
    and the zodiacal light model, 
    $\Delta Z_{\nu} = Z_{\nu}-\left<Z_{\nu}\right>$ (\emph{middle right}), 
    where brackets indicate full-survey averages. Correspondingly, the 
    final $\chi^2$ is defined through $\Delta I_{\nu} - \Delta Z_{\nu}$ 
    (\emph{bottom right}), and is by constrution only sensitive to 
    time-variable signals. In contrast, the basic data element in 
    \Cosmoglobe\ is the full sky signal, $I_{\nu}$ (\emph{top left}), 
    which is fitted with the full zodiacal light model, $Z_{\nu}$ 
    (\emph{middle left}), both modelled in time-domain. The $\chi^2$ 
    the minimizes minimize the total signal-minus-model residual, 
    $I_{\nu}-Z_{\nu}$ (\emph{bottom left}). The main advantage of the 
    DIRBE approach is insensitivity to stationary sky signals, in 
    particular thermal dust and CIB, while the main advantage of the 
    \Cosmoglobe\ approach is a much higher effective signal-to-noise 
    ratio, both to zodiacal light parameters and zero-levels.}
    \label{fig:week_vs_full}
\end{figure*}

As noted by \citet{hauser1998} and \citet{Kelsall1998}, the DIRBE TOD
contain significant excess radiation that is not well described by the
low-dimensional parametric K98 model. Shortly after these
observations, \citet{leinert:1998} showed that some of this radiation
appeared to be stationary in solar-centric coordinates; see their
Figure~54. Such radiation can in principle be created through several
different physical mechanisms. For instance, a yet unknown zodiacal
component could create a signal that appears stationary in
solar-centric coordinates, just like the circular-solar ring described
in Sect.~\ref{sec:ring}, or it could also be caused by straylight
contamination in the DIRBE optics. However, even though this radiation
was first noted more than two decades ago, it was never mapped out
systematically until now, as part of the current \cosmoglobe\ DR2
analysis \citep{CG02_01}. For the time being, we choose to remain
agnostic regarding the physical origin of this signal, and therefore,
strictly speaking, the ZL model presented in the current paper only
describes the parts of the total observed ZL that is attributable to
the K98 parametrization. In the future, it is possible that the static
component presented by \citet{CG02_01} should also be added to this
model. However, before that is done, it is imperative to rule out the
straylight hypothesis, and that will require both detailed modelling
of the DIRBE instrument and joint analysis with other experiments,
such as AKARI, IRAS, and \Planck\ HFI. Doing that is beyond the scope
of the current \cosmoglobe\ data release, but it will certainly be a
main topic for future work.


\subsection{Comparison with K98 fitting algorithm}
\label{sec:algorithm_comparison}

Before describing the numerical implementation adopted for sampling
from Eq.~\eqref{eq:gibbs_zodi} in this paper, it is worth first
considering the more important fundamental differences between our
approach and that adopted by the DIRBE team as described by
\citet{Kelsall1998}. The first difference worth noting in this respect
is that while our $\chi^2$ statistic is defined directly in terms of
TOD, the K98 parameter estimation method rather work weekly maps. That
is, the raw data are co-added week-by-week into pixelized maps, and
these are fed into a corresponding pixel-based $\chi^2$ statistic that
also accepts the ZL model in terms of pixelized maps. One important
motivation for working with weekly maps is generally lower
computational requirements, which was relatively more important two
decades ago that it is today.

A second important difference between the two algorithms --- and this
is conceptually a far more important one -- is the fact that while our
method makes active use of an explicit parametric data model for all
non-ZL components, the K98 algorithm eliminates any contribution from
non-ZL components directly by only considering differences between
weekly maps and the corresponding full-mission average map in their
$\chi^2$ statistic. That is, rather than optimizing the full $\chi^2$
as defined in Eq.~\eqref{eq:gibbs_chisq}, their algorithm optimizes
\begin{equation}
  -2\ln P(\zeta_{\mathrm{z}}|\dv, \ldots) = \sum_{i,\nu}
  \left(\frac{\Delta\dv_{i,\nu} -
    \Delta\s_{i,\nu,\mathrm{zodi}}(\zeta_\mathrm{s})}{\sigma_{\nu}}\right)^2 \equiv
  \chi^2_{\mathrm{K98}} (\zeta_{\mathrm{z}}),
  \label{eq:k98_chisq}
\end{equation}
where $i$ indicate week number, $\Delta \dv_{i,\nu} = \dv_{i,\nu} -
\left<\dv_{i,\nu}\right>$, $\Delta \s_{i,\nu,\mathrm{zodi}} =
\s_{i,\nu,\mathrm{zodi}} - \left<\s_{i,\nu,\mathrm{zodi}}\right>$, and brackets
denote averaging over the full mission.

Clearly, this statistic has a key philosophical advantage as compared
to the full-signal statistic in Eq.~\eqref{eq:gibbs_chisq}: It does
not require any assumptions regarding the astrophysical nature of a
clearly complicated infrared sky. At least to first order, it is by
construction safe against biases from foreground modelling
errors. However, this bias immunity also comes at a massive cost in
terms of statistical uncertainties, because it is not only immune to
astrophysical bias, but it is also by construction blind to any
stationary ZL signal --- and by far most of the actual ZL observed in
the sky does indeed appear stationary on the sky.

Figure~\ref{fig:week_vs_full} illustrates this difference. The top
left panel shows the full intensity signal as analyzed in the
\cosmoglobe\ algorithm for one single week of 25\,$\mu$m
observations. The visual imprint is strongly dominated by the same ZL
features as seen in Sect.~\ref{sec:model}, aligned with the Ecliptic
plane. The right panel show the same after subtracting the
full-mission mean; the characteristic cloud pattern has now turned
into differential structures that are difficult to interpret
visually. The middle row shows the same for the predicted ZL signal,
and the bottom row shows the difference between the top and middle
rows, which serves as the input to the $\chi^2$ evaluations.

Several points are worth noting in these figures. First of all, we
immediately note that the color scale is one order of magnitude lower
in the right column than in the left column; this will translate
directly into lower constraining power for the differential
approach.

Second, we see that the Galactic plane signal represents a strongly
sub-dominant component in the total signal amplitude. Even relatively
large errors made in the model assumptions of these will have a very
small impact on the overall ZL estimates, and it is also
straightforward to mitigate this effect further by masking out any
samples that are close known bright Galactic sources; this is fully
equivalent to what is done in the CMB field when estimating the CMB
power spectrum.

Third, as seen in the bottom panel, the $\chi^2_{\mathrm{K98}}
(\zeta_{\mathrm{z}})$ aslo by construction entirely blind to the
zero-level of the ZL model: The large relative monopole error between
the data and the model seen in the bottom right panel is entirely
suppressed in the bottom left panel, and there is by construction no
way for the differential method to constrain the absolute level ZL
monopole. On the one hand, such blindness may certainly be considered
to be an algorithmic strength, as indeed argued by
\citet{Kelsall1998}, given that one of the main goals of the entire
DIRBE experiment was to precisely measure the CIB monopole spectrum
\citep{hauser1998}. Nevertheless, the final derived CIB constraints do
of course still depend directly on reconstructed ZL monopole, whatever
it may be. Intuitively speaking, the differential method aims to
measure the ZL monopole using derivatives alone. Whether that task is
easier or harder than to establish a sufficiently accurate model of
the Milky Way can only be determined by trying both methods, and
comparing the results. In addition, it is also worth noting that
derivative measurements in general are far more susceptible to
systematic biases from any non-Galactic source than absolute intensity
measurements. One important example in this respect is optical
non-idealities.

\subsection{Posterior sampling by non-linear optimization}
\label{sec:nonlin}

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{figs/powell_red_chisq_vs_iter.pdf}
    \caption{Reduced $\chi^2$ as a function of Powell likelihood evaluation count for one single Gibbs chain. Each discrete jump indicates the start of a new Gibbs sample, which is initialized on a new random point that is close to the previous iteration. The following systematic decline within each main Gibbs iteration indicates the non-linear optimization performed by the Powell algorithm.  The solid dark region corresponds to a large number of highly sub-optimal parameter trials. }
    \label{fig:powell_chisq_iter}
\end{figure}


\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{figs/powell_T0_vs_chisq.pdf}
    \caption{Reduced $\chi^2$ as a function of the temperature at 1\,AU, $T_0$. Each curve shows the full set of parameter trials within one single main Gibbs iteration (or Powell call), and different colors indicate different Gibbs iteration. Redder colors are earlier in the chain.}
    \label{fig:powell_T0}
\end{figure}

Before concluding this section, we still need to specify the details
of the algorithm used to draw samples from
Eq.~\eqref{eq:gibbs_zodi}. A broad range of Bayesian sampling methods
can be envisioned used for this purpose, from a simple
Metropolis-Hastings (MH) accept-reject sampler to various incarnations
of Hamiltonian samplers that exploit on derivative
information. Indeed, our very first implementation was due to its
implementational simplicity an MH sampler with manually tuned step
lengths, and this was used for early model exploration and code
testing. However, this approach was quickly abandoned because it,
after a short burn-in period, got stuck in a local minimum, after
which all proposed samples were rejected.

The main problem


\section{Data}\label{sect:data}

\subsection{DIRBE Calibrated Individual Observations}

\subsection{Masks}


\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{figs/tod_zodi.pdf}
    \caption{}
    \label{fig:tod_zodi}
\end{figure}


\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{figs/zodi_proc_masks.pdf}
    \caption{Three of the processing masks used when estimating ZL parameters. The blue mask is the 
    mask used in the stellar emission dominated 1.25 $\mathrm{\mu m}$ band, the orange mask is used 
    in the ZL dominated 25 $\mathrm{\mu m}$ band, and the green mask is used in the thermal dust dominated 
    240 $\mathrm{\mu m}$ band.}
    \label{fig:zodi-procmask}
\end{figure}





\section{Results}\label{sect:improved-model}
Here we present our best-fit ZL model from having run Commander3 for six independant
Markov Chains for N samples. Our best-fit parameters for the geometrical IPD, emissivities 
and albedo parameters are listed in tables~\ref{table:zodi-params-geo} 
and~\ref{table:zodi-params-spectral}, where they are compared to the values in the K98 model.
\input{ipd_param_table.tex}

\subsection{Markov chains}

\begin{figure*}
    \centering
    \includegraphics[width=1\textwidth]{figs/total_trace.pdf}
    \caption{Trace plot of all geometrical interplanetary dust paramteres for six independant Markov chains.}
    \label{fig:trace-ipd}
\end{figure*}

\begin{figure*}
    \centering
    \includegraphics[width=1\textwidth]{figs/emissivity_and_albedo_trace.pdf}
    \caption{Trace plot of all geometrical interplanetary dust paramteres for six independant Markov chains.}
    \label{fig:trace-emissivity-albedo}
\end{figure*}


\subsection{Updated ZL model and goodness-of-fit}

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{figs/zodi_intensity.pdf}
    \caption{Simulated ZL intensity on January 1, 2024 as a function of wavelength from the best-fit 
    Cosmoglobe ZL model, made with ZodiPy. The ZL SED is directional 
    and seasonal due to temperature variations along independent line-of-sights and variations in IPD composition. 
    The black curve shows the mean sky intensity in a HEALPix map with resolution
    $N_\mathrm{side}= 64$ where pixels with an angular separation of less than
    $60^\circ$ are masked out. The colored dashed lines represent the ZL 
    intensity
    }
    \label{fig:zodi-intensity}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=\columnwidth]{figs/zodi_reldiff.pdf}
    \caption{}
    \label{fig:reldiff}
\end{figure}


\begin{table}
\newdimen\tblskip \tblskip=5pt
\caption{}
\label{tab:chisq}
\vskip -4mm
\footnotesize
\setbox\tablebox=\vbox{
 \newdimen\digitwidth
 \setbox0=\hbox{\rm 0}
 \digitwidth=\wd0
 \catcode`*=\active
 \def*{\kern\digitwidth}
%
  \newdimen\dpwidth
  \setbox0=\hbox{.}
  \dpwidth=\wd0
  \catcode`!=\active
  \def!{\kern\dpwidth}
%
  \halign{\hbox to 2cm{#\leaderfil}\tabskip 2em&
    \hfil$#$\hfil \tabskip 2em&
    \hfil$#$\hfil \tabskip 2em&
    \hfil$#$\hfil \tabskip 0em\cr
\noalign{\doubleline}
\omit\sc $\lambda$ ($\mu\mathrm{m}$)\hfil& N_{\mathrm{samp}} (10^3) & \sigma_{0}^{\mathrm{(a)}} [\mathrm{MJy/sr}] & \chi^2_{\mathrm{red}} \cr
\noalign{\vskip 3pt\hrule\vskip 5pt}
*1.25   & *70 & *0.031 & 0.756 \cr 
*2.2    & *51 & *0.031 & 0.770 \cr 
*3.5    & *51 & *0.026 & 1.019 \cr 
*4.9    & *99 & *0.029 & 1.150 \cr 
*12     & 225 & *0.102 & 2.649 \cr
*25     & \cdots & *0.190 & \cdots \cr 
*60     & *97 & *0.322 & 1.501 \cr 
100     & *85 & *0.381 & 1.415 \cr 
140     & 187 & 32.1*  & 1.015 \cr 
240     & 177 & 18.3*  & 1.024 \cr 
\noalign{\vskip 5pt\hrule\vskip 5pt}}}
  \endPlancktable
  \tablenote {{\rm a}} Mission average TOD noise rms per 8\,Hz sample.\par
\par
\end{table}


\begin{figure*}[t]
    \centering
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_01a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_01b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_01.pdf}\hspace*{3mm}
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_02a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_02b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_02.pdf}\\
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_03a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_03b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_03.pdf}\hspace*{3mm}
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_04a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_04b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_04.pdf}\\
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_05a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_05b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_05.pdf}\hspace*{3mm}
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_06a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_06b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_06.pdf}\\
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_07a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_07b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_07.pdf}\hspace*{3mm}
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_08a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_08b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_08.pdf}\\
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_09a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_09b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_09.pdf}\hspace*{3mm}
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_10a.pdf}%
    \includegraphics[width=0.22\linewidth]{figs/compare_zodi_res/cosmoglobe_res_10b.pdf}%
    \includegraphics[width=23mm,angle=90]{figs/compare_zodi_res/cbar_10.pdf}%
    \caption{Half-mission split residual maps, smoothed by a 0.5 degrees or 15 arcmin beam.}
    \label{fig:half-mission-res2}
\end{figure*}



We illustrate the effectiveness of our model in figures~\ref{fig:dr2-zsma-compare1} 
and~\ref{fig:dr2-zsma-compare2}, which shows the data minus model residuals for both models.
We obtain cleaner residuals in all DIRBE channels with our new ZL model, most notably in the 12 and 25 $\mu$m  
ZL dominated channels.

Figure~\ref{fig:zodi-intensity} shows the interpolated ZL signal as a function of wavelength. The SED will be a composite of many independant 


\subsection{Comparison of ZSMA maps}

\textcolor{red}{(Fill in once the zodi paper gets further along and we have our results)}
\begin{figure*}
    \centering

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_01.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_01.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_01.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_01.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_01.pdf}%
    }\\


    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_02.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_02.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_02.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_02.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_02.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_03.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_03.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_03.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_03.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_03.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_04.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_04.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_04.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_04.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_04.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_05.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_05.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_05.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_05.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_05.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_06.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_06.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_06.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_06.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_06.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_07.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_07.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_07.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_07.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_07.pdf}%
    }\\
    \caption{Comparison between ZL subtractions with our best-fit ZL model and with K98. 
    \textit{(left column):} Mission-averaged frequency maps containing ZL after data selection at our native HEALPix resolution 
    of $N_\mathrm{side} = 512$. \textit{(middle column):} DIRBE ZSMA maps
    at $N_\mathrm{side} = 256$.\textit{(right column):} Our ZL subtracted mission-average 
    maps, downgraded to $N_\mathrm{side} = 256$. The rows list to DIRBE frequency channels, from top to 
    bottom. We observe a clear improved ZL solution at all DIRBE channels. \textcolor{red}{(Replace left column with correct frequency maps)}
    }
    \label{fig:dr2-zsma-compare1}
\end{figure*}

\begin{figure*}
    \centering
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_08.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_08.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_08.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_08.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_08.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_09.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_09.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_09.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_09.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_09.pdf}%
    }\\

    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_ma_10.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_tot_10.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/dirbe_zsma_10.pdf}%
    \includegraphics[height=1cm]{figs/compare_freq_maps/cosmoglobe_zsma_10.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/compare_freq_maps/cbar_10.pdf}%
    }\\

    \caption{Comparison between ZL subtractions with our best-fit ZL model and with K98. 
    \textit{(left column):} Mission-averaged frequency maps containing ZL after data selection at our native HEALPix resolution 
    of $N_\mathrm{side} = 512$. \textit{(middle column):} DIRBE ZSMA maps
    at $N_\mathrm{side} = 256$. The rows list to DIRBE frequency channels, from top to 
    bottom. \textit{(right column):} Our ZL subtracted mission-average 
    maps, downgraded to $N_\mathrm{side} = 256$. We observe a clear improved ZL solution at all DIRBE channels.
    }    
    \label{fig:dr2-zsma-compare2}
\end{figure*}







\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{figs/zodi_mean_diff_DIRBE_DR2.pdf}
    \caption{Monopole difference between official DIRBE and
      \cosmoglobe\ DR2 ZSMA maps, evaluated as the average of the
      difference between the maps shown in the second and third
      columns in Figs.~\ref{fig:dr2-zsma-compare1} and
      \ref{fig:dr2-zsma-compare2} over the DR2 analysis masks.}
    \label{fig:zsma_mean}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{figs/zodi_rms_ratio_DIRBE_DR2_v2.pdf}
    \caption{Rms ratio between \cosmoglobe\ DR2 and DIRBE ZSMA, ,
      $\sigma_{\mathrm{DR2}}/\sigma_\mathrm{DIRBE}$,
      as evaluated outside the DR2 analysis masks.}
    \label{fig:zsma_rms}
\end{figure}



\begin{figure*}
    \centering
    \includegraphics[width=\linewidth]{figs/tod_zodi_residuals.pdf}
    \caption{}
    \label{fig:res_vs_b}
\end{figure*}


Subtracting the ZL with our best-fit-model yields lower sky residuals at all bands 
compared to the DIRBE ZSMA maps. A comparison between the ZL residuals can be seen 
in Figure~\ref{fig:dr2-zsma-compare}. Here the first column shows the frequency maps of the
four most ZL dominated DIREB bands (4.9, 12, 25, and 60 $\mu$m), the second shows the ZL
subtracted maps with our model, and column three shows the DIRBE ZSMA.




\section{Conclusions}
\label{sec:conclusions}


\begin{acknowledgements}
 The current work has received funding from the European
  Unions Horizon 2020 research and innovation programme under grant
  agreement numbers 819478 (ERC; \textsc{Cosmoglobe}) and 772253 (ERC;
  \textsc{bits2cosmology}). Some of the results in this paper have been 
  derived using the HEALPix \citep{Gorski2005} package.
  We acknowledge the use of the Legacy Archive for Microwave Background 
  Data
  Analysis (LAMBDA), part of the High Energy Astrophysics Science
  Archive Center
  (HEASARC). HEASARC/LAMBDA is a service of the Astrophysics Science 
  Division at the NASA Goddard Space Flight Center.  
\end{acknowledgements}


%-------------------------------------------------------------
%                                       Table with references 
%-------------------------------------------------------------
%

\bibliographystyle{aa}
\bibliography{../../common/CG_bibliography,references,../../common/Planck_bib,references}
%\bibliography{references}

\appendix
\onecolumn

\section{Component-wise zodiacal light maps and number density cross-sections}
\label{sec:zodi-comps}

% \noindent\begin{minipage}{\textwidth}
In this Appendix, we present maps of visualizations of our best-fit ZL 
light model. Such figures can help illustrate the physical properties 
of the model and help validate how physical our models are. The ZL 
component-wise maps, both the mission-averaged and the instantaneous maps 
in~\ref{fig:mission-averaged-comp-maps} 
and~\ref{fig:mission-averaged-inst-maps}, respectively, are compared to 
the K98 model. The IPD number density visualization for the K98 model, 
corresponding to Figure~\ref{fig:ipd-number-density} can be seen in 
Figure~X in~\cite{San2022} .


% \end{minipage}

\begin{figure*}
    \centering
    \includegraphics[width=\textwidth]{figs/number_density.pdf}
    \caption{Visualization of the IPD number density of the four fitted zodiacal components in our model. The number densities are shown as a cross-section of the Solar system in the xz-plane. \textit{(top left):} The smooth cloud. \textit{(top right):} Dust band 1. \textit{(bottom left):} Dust band 2. \textit{(bottom right):} Dust band 3. The gray dotted line represents the ecliptic plane and helps illustrate the variations in the components symmetry planes.}
    \label{fig:ipd-number-density}
\end{figure*}


\begin{figure*}
    \centering
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_0_inst.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/CG_0_inst.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_0_inst.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_1_inst.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/CG_1_inst.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_1_inst.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_2_inst.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/CG_2_inst.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_2_inst.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_3_inst.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/CG_3_inst.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_3_inst.pdf}%
    }\\
    \caption{Full-sky component-wise ZL maps (January 1, 2024) at $25\mu$m made with ZodiPy. 
    \textit{(left column:)} The K98 model. \textit{(right column:)} Best-fit Cosmoglobe ZL model. 
    Rows list the zodiacal components, from top to bottom, 1) smooth cloud; 2) dust band 1; 3) 
    dust band 2; 4) dust band 3. The maps are in ecliptic coordinates, with the Sun marked as 
    an orange circle.}
    \label{fig:mission-averaged-inst-maps}
\end{figure*}

\begin{figure*}[hbt]
    \centering
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_0.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/DR2_0.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_0.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_1.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/DR2_1.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_1.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_2.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/DR2_2.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_2.pdf}%
    }\\
    \resizebox{\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/comp_maps/K98_3.pdf}%
    \includegraphics[height=1cm]{figs/comp_maps/DR2_3.pdf}%
    \includegraphics[width=1cm,angle=90]{figs/comp_maps/cbar_3.pdf}%
    }\\
    \caption{Mission-averaged component-wise ZL maps at $25\mu$m made with ZodiPy. 
    \textit{(left column:)} The K98 model. \textit{(right column:)} Best-fit Cosmoglobe ZL model.
    Rows list the zodiacal components, from top to bottom, 1) smooth cloud; 2) dust band 1; 3) 
    dust band 2; 4) dust band 3. The maps are in galactic coordinates.}
    \label{fig:mission-averaged-comp-maps}
\end{figure*}

\clearpage

\section{Interplanetary dust parameter atlas}
\label{sec:param-atlas}
In this Appendix, we present an atlas of mission-averaged ZL parameter maps.
Each map represents the effect of changing one ZL model parameter by $\pm 5\%$ while holding the other fixed. The maps are normalized.

\begin{figure*}[hbt]
    \centering
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_01.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_01.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_01.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_01.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_02.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_02.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_02.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_02.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_03.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_03.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_03.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_03.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_04.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_04.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_04.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_04.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_05.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_05.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_05.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_05.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_06.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_06.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_06.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_06.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_07.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_07.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_07.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_07.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_08.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_08.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_08.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_08.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_09.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_09.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_09.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_09.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/C_10.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B1_10.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B2_10.pdf}%
    \includegraphics[height=1cm]{figs/atlas/B3_10.pdf}%
    }\\
   
    \caption{ZL parameter atlas showing the difference between increasing 
    and lowering each ZL model parameter by $5\%$ in the form of normalized 
    mission-averaged ZL maps. Columns list, from left to right parameters of
    1) the smooth cloud; 2) dust band 1; 3) dust band 2; and 4) dust band 3.}
    \label{fig:atlas1}
\end{figure*}
\begin{figure*}
    \centering
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/SR_01.pdf}%
    \includegraphics[height=1cm]{figs/atlas/SR_06.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_01.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_06.pdf}%
    }\\   
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/SR_02.pdf}%
    \includegraphics[height=1cm]{figs/atlas/SR_07.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_02.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_07.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/SR_03.pdf}%
    \includegraphics[height=1cm]{figs/atlas/SR_08.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_03.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_08.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/SR_04.pdf}%
    \includegraphics[height=1cm]{figs/atlas/SR_09.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_04.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_09.pdf}%
    }\\
    \resizebox{0.82\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/SR_05.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_05.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_10.pdf}%
    \includegraphics[height=1cm]{figs/atlas/TF_11.pdf}%
    }\\
    \resizebox{0.41\textwidth}{!}{%
    \includegraphics[height=1cm]{figs/atlas/general_01.pdf}%
    \includegraphics[height=1cm]{figs/atlas/general_02.pdf}%
    }
    %\hspace*{0.47\textwidth}
    \caption{ZL parameter atlas showing the difference between increasing 
    and lowering each ZL model parameter by $5\%$ in the form of normalized 
    mission-averaged ZL maps. Columns list, from left to right parameters of
    1) the smooth cloud; 2) dust band 1; 3) dust band 2; and 4) dust band 3.}
    \label{fig:atlas2}
\end{figure*}




\end{document}
%%%% End of aa.dem



For computational reasons it is sometimes necessary to violate the Gibbs rule,
which is the case for the step in Equation~\ref{eq:gibbs_zodi}, which describes
the sampling of the ZL parameters, denoted by $\zeta_\mathrm{z}$. The K98 ZL 
model contains around 50 parameters to describe the three-dimensional IPD 
distribution and another 30 or more to describe the thermal emission and 
scattered sunlight source functions, many of which are heavily degenerate
due to the difficulties of mapping a three-dimensional structure from a single
data set. N of these parameters were fit to the DIRBE data, in the original DIRBE analysis while the rest were fixed to parameters motivated by studies of the interplanetary medium. In our analysis we have fit M total parameters. A visualization of the degeneracies and the way in which each ZL parameter impacts the final mission-averaged predicted ZL are seen in figures~\ref{fig:atlas1} and~\ref{fig:atlas2} in Appendix~\ref{sec:param-atlas}. This atlas of ZL parameters shows normalized maps of the effects of changing a single ZL parameter by $\pm 5\%$ while keeping the rest of the model fixed. The albedo and emissivity parameters are excluded from the atlas as these represent a direct scaling of the component maps and are degenerate with the $n_0$ maps.
The posterior distribution of this complicated set of parameters exhibits a large number of local minima due to the above mentioned reasons. When experimenting we found that strict Gibbs sampling algorithm quickly became trapped. We have opted to instead 
use a simple non-linear Powell algorithm that is initialized some random parameter distance away from the previous sample, and then searches for the local minimum. Powell's method is a function minimizer, which performs bi-directional searches along a parameter vector. This algorithm is able to escape local minima, but it comes at the cost of larger
uncertainties than what would result from an ideal posterior mapper.





The K98 model was obtained by fitting the model to a set of week-maps. 
The $\chi^2$ measure used by the DIRBE team is given by
\begin{equation}
    \chi^2_\mathrm{K98} = \Delta I_\nu - \Delta Z_\nu,
\end{equation}
where $I_\nu$ and $Z_\nu$ are the full-mission frequency and ZL estimate 
maps, and $\Delta I_\nu = I_\nu - \langle I_\nu \rangle$ and $\Delta Z_\nu = Z_\nu - \langle Z_\nu \rangle$ are the difference between 
the full-mission and a week frequency and ZL map, respectively. These 
maps are illustrated in the left column in Figure~\ref{fig:week_vs_full}. 
$\chi^2_\mathrm{K98}$ is by construction only sensitive to time-variable 
signal, effectively removing the need for a good sky model of the then 
less well-understood infrared sky. Using week maps instead of the full 
timestreams has the additional effect of reducing the overall data 
volume in the fits, which would seem beneficial considering the 
computing resources available during the early DIRBE analysis. A 
downside of this method is that the monopole induced by the smooth ZL is 
removed, resulting in a much weaker signal-to-noise ratio in the ZL 
parameter estimates and to the zero-levels. In contrast, we fit the data 
at each time step to the signal minus model residual
\begin{equation}\label{eq:chisq}
    \chi^2 = I_\nu - Z_\nu.
\end{equation}
To minimize the amount of unmodeled galactic emission that enters our 
ZL parameter estimates, we use strict channel-specific processing masks, 
masking out the brightest galactic regions. The 1.25, 25, and 240 $\mu$m 
masks, corresponding to stellar light, ZL, and thermal dust-dominated 
channels, are shown in Figure~\ref{fig:zodi-procmask}.




The total number of free ZL model parameters in this analysis are N, 
compared to the M parameters fit in K98. We have included a non-zero
scattering contribution at 4.9 $\mu$m. The ZL SED is composition of two
blackbody like spectra with a combined minimum around the $3.5\mu$m band. The first
blackbody spectrum is associated with the solar flux through the scattering 
contribution, while the second with the re-radiated thermal emission. With an
improved sky model and lower residual levels, we believe that it is worth 
including the small non-zero contribution from scattering at 4.9 $\mu$m.
Additionally, we are using the 12 $\mu$m band as our ZL reference band, meaning
that we fix the emissivities at this band to 1 \textcolor{red}{(why?)}. The
reference ZL band in K98 is $25 \mu$m. Similar to K98, we fit one emissivity 
for the smooth cloud, and one joint emissivity for the dust bands, while we 
only fit one overall albedo for all components, at each frequency band. Where,
K98 fixed emissivities to the cloud at certian bands, we have kept all free.

We can improve our error estimates on the ZL parameters by including the 
Powell search history in our error estimation. For each bi-directional 
search, we output both the parameter values and the intermediate $\chi^2$
values which lets us find the 95\% confidence interval in the search. This
is used jointly with the uncertienties determined from the Gibbs chain.
\textcolor{red}{Do this with Duncan}
